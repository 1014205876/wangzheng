<app-crumb [url]="['产品与订单','订单管理','结果录入']"></app-crumb>
<nz-card class="shadow mb20" [nzTitle]="'基本信息'">
    <nz-table #tableData [nzData]='[1]' [nzShowPagination]='false' [nzFrontPagination]="false"
        [nzBordered]='true'>
        <tbody>
            <tr>
                <td style='width:20%'>订单号</td>
                <td style='width:30%'>{{loanApply.no}}</td>
                <td style='width:20%'>订单状态</td>
                <td style='width:30%' *ngIf="loanApply.status=='0'">处理中</td>
                <td style='width:30%' *ngIf="loanApply.status=='1'">已终止</td>
                <td style='width:30%' *ngIf="loanApply.status=='2'">处理完成</td>
            </tr>
            <tr>
                <td>客户名称</td>
                <td>{{loanApply.controllerName}}</td>
                <td>申请产品</td>
                <td>{{loanApply.productName}}</td>
            </tr>
            <tr>
                <td>申请贷款金额</td>
                <td>{{loanApply.amount}}万元</td>
                <td>申请贷款期限</td>
                <td>{{loanApply.term}}个月</td>
            </tr>
            <tr>
                <td>还款方式</td>
                <td>{{loanApply.repayMethod}}</td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </nz-table>
</nz-card>
<nz-card class="shadow mb20" [nzTitle]="'结果信息'">
    <form nz-form [formGroup]="formData" (ngSubmit)="submitForm($event)">
        <div nz-row>
            <div nz-col [nzSpan]="20">
                <nz-form-item nzFlex>
                    <nz-form-label [nzSpan]="4" nzRequired>最终结果</nz-form-label>
                    <nz-form-control [nzSpan]="20">
                        <nz-radio-group formControlName="status" [(ngModel)]="form.status">
                            <label nz-radio nzValue="1">已终止</label>
                            <label nz-radio nzValue="2">处理完成</label>
                        </nz-radio-group>
                        <nz-form-explain *ngIf="formData.get('status').dirty && formData.get('status').errors">请选择处理结果
                        </nz-form-explain>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>
        <ng-container *ngIf="form.status=='1'">
            <div nz-row>
                <div nz-col [nzSpan]="20">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="4" nzRequired>终止原因</nz-form-label>
                        <nz-form-control [nzSpan]="20">
                            <textarea nz-input rows="2" formControlName="reason" [(ngModel)]='form.reason'
                                placeholder="请填写终止原因"></textarea>
                            <nz-form-explain *ngIf="formData.get('reason').dirty && formData.get('reason').errors">
                                请填写终止原因</nz-form-explain>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
        </ng-container>
        <ng-container *ngIf="form.status=='2'">
            <div nz-row>
                <div nz-col [nzSpan]="10">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="8">放款时间</nz-form-label>
                        <nz-form-control [nzSpan]="16">
                            <nz-date-picker [nzStyle]="{'width':'100%'}" formControlName="loanDate" [(ngModel)]="date" [nzShowTime]="true"
                                (ngModelChange)="onChange($event)" nzPlaceHolder="请填写放款时间"></nz-date-picker>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row>
                <div nz-col [nzSpan]="10">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="8" nzRequired>批复金额</nz-form-label>
                        <nz-form-control [nzSpan]="16">
                            <input nz-input formControlName="approvalAmount" [(ngModel)]='form.approvalAmount'
                                placeholder="请填写批复金额">
                            <nz-form-explain
                                *ngIf="formData.get('approvalAmount').dirty && formData.get('approvalAmount').errors">
                                请填写批复金额</nz-form-explain>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="10">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="8" nzRequired>批复期限（月）</nz-form-label>
                        <nz-form-control [nzSpan]="16">
                            <input nz-input formControlName="approvalTerm" [(ngModel)]='form.approvalTerm'
                                placeholder="请填写批复期限">
                            <nz-form-explain
                                *ngIf="formData.get('approvalTerm').dirty && formData.get('approvalTerm').errors">
                                请填写批复期限</nz-form-explain>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row>
                <div nz-col [nzSpan]="10">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="8" nzRequired>批复利率</nz-form-label>
                        <nz-form-control [nzSpan]="16">
                            <input nz-input formControlName="loanRate" [(ngModel)]='form.loanRate'
                                placeholder="请填写批复利率">
                            <nz-form-explain *ngIf="formData.get('loanRate').dirty && formData.get('loanRate').errors">
                                请填写批复利率</nz-form-explain>
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="10">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="8" nzRequired>还款方式</nz-form-label>
                        <nz-form-control [nzSpan]="16">
                            <nz-select formControlName="repayMethod" [(ngModel)]='form.repayMethod' style="width:100%">
                                <nz-option nzDisabled [nzLabel]="'请选择还款方式'" [nzValue]="''"></nz-option>
                                <nz-option *ngFor="let option of repayMethodArr" [nzLabel]="option" [nzValue]="option">
                                </nz-option>
                            </nz-select>
                            <nz-form-explain
                                *ngIf="formData.get('repayMethod').dirty && formData.get('repayMethod').errors">请选择还款方式
                            </nz-form-explain>
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
            <div nz-row>
                <div nz-col [nzSpan]="10">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="8">居间服务费率</nz-form-label>
                        <nz-form-control [nzSpan]="16">
                            <input nz-input formControlName="serviceRate" [(ngModel)]='form.serviceRate'
                                placeholder="请填写居间服务费率">
                        </nz-form-control>
                    </nz-form-item>
                </div>
                <div nz-col [nzSpan]="10">
                    <nz-form-item nzFlex>
                        <nz-form-label [nzSpan]="8">合同编号</nz-form-label>
                        <nz-form-control [nzSpan]="16">
                            <input nz-input formControlName="no" [(ngModel)]='form.no' placeholder="请填写合同编号">
                        </nz-form-control>
                    </nz-form-item>
                </div>
            </div>
        </ng-container>
        <div nz-row>
            <div nz-col [nzSpan]="24" style='text-align:center'>
                <button nz-button (click)='goBack()' style='margin-right:20px;'>返回</button>
                <button nz-button [nzType]="'primary'" [disabled]="canSubmit">保存结果</button>
            </div>
        </div>
    </form>
</nz-card>