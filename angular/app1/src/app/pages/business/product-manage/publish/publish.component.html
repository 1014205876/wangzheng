<app-breadcrumbs [breadcrumbs]="breadcrumbs"></app-breadcrumbs>
<nz-card class="card" [nzTitle]="'产品信息'" *ngIf="data.type=='new'">
  <div class="m-b-20" nz-row nzType="flex" nzJustify="space-between" nzAlign="middle">
    <div class="gutter-box" nz-col nzSpan="6">
      绑定产品:
      <nz-select style="width: calc(100% - 70px);" [(ngModel)]="data.index" [nzPlaceHolder]="'请选择产品'">
        <nz-option *ngFor='let list of data.infor;let i=index' [nzValue]='i' [nzLabel]="list.name">{{list.name}}
        </nz-option>
      </nz-select>
    </div>
    <div class="gutter-box" nz-col nzSpan="6">
      <a *ngIf='data.infor.length>0' [routerLink]="['/app/business/product/info']"
        [queryParams]="{'id': data.infor[data.index].id}">查看产品详细信息</a>
    </div>
  </div>
  <div nz-row nzType="flex" nzJustify="space-around" nzAlign="middle" *ngFor='let list of data.infor;let index=index'
    [hidden]='index!=data.index'>
    <div class="gutter-box" nz-col nzSpan="6">产品编号：{{list.number}}</div>
    <div class="gutter-box" nz-col nzSpan="6">贷款期限（月）：{{list.minTerm}}-{{list.maxTerm}}</div>
    <div class="gutter-box" nz-col nzSpan="6">贷款金额（万）：{{list.minAmount}}-{{list.maxAmount}}</div>
    <div class="gutter-box" nz-col nzSpan="6">贷款利息（年化）：{{list.minRate}}%-{{list.maxRate}}%</div>
  </div>
</nz-card>
<nz-card class="card" [nzTitle]="'产品信息'" *ngIf="data.type=='edit'">
  <div class="m-b-20" nz-row nzType="flex" nzJustify="space-between" nzAlign="middle">
    <div class="gutter-box" nz-col nzSpan="6">
      绑定产品：{{data.product.name}}
    </div>
    <div class="gutter-box" nz-col nzSpan="6">
      <a *ngIf='data.infor.length>0' [routerLink]="['/app/business/product/info']"
        [queryParams]="{'id': data.id}">查看产品详细信息</a>
    </div>
  </div>
  <div nz-row nzType="flex" nzJustify="space-around" nzAlign="middle">
    <div class="gutter-box" nz-col nzSpan="6">产品编号：{{data.product.number}}</div>
    <div class="gutter-box" nz-col nzSpan="6">贷款期限（月）：{{data.product.minTerm}}-{{data.product.maxTerm}}</div>
    <div class="gutter-box" nz-col nzSpan="6">贷款金额（万）：{{data.product.minAmount}}-{{data.product.maxAmount}}</div>
    <div class="gutter-box" nz-col nzSpan="6">贷款利息（年化）：{{data.product.minRate}}%-{{data.product.maxRate}}%</div>
  </div>
</nz-card>
<nz-card class="card" [nzTitle]="'表单配置'" [nzExtra]="extraTemplate">
  <ng-template #extraTemplate>
    <button (click)="addRow(data.group, 'groupItem')" nz-button nzType="primary"><i nz-icon
        nzType="plus"></i>新增分组</button>
  </ng-template>
  <div *ngFor="let list of data.group;let i=index">
    <div class="m-b-20" nz-row nzType="flex" nzJustify="space-between" nzAlign="middle">
      <div nz-col nzSpan="10">
        <div nz-row nzJustify="start" nzAlign="middle" style="line-height: 32px;">
          <div nz-col nzSpan="3">分组名称:</div>
          <div nz-col nzSpan="10"><input nz-input placeholder="请输入分组名称" [(ngModel)]="list.groupName" /></div>
          <div nz-col nzSpan="10" nzOffset="1">
            <label nz-checkbox [(ngModel)]="list.groupShow"
              (ngModelChange)='checkchange(list,"groupShow",$event)'>分页显示此分组</label>
          </div>
        </div>
      </div>
      <div nz-col nzSpan="8">
        <button class="m-r-20" [disabled]="i==0" (click)="moveup(i,data.group)" nz-button nzType="primary"><i nz-icon
            nzType="arrow-up"></i>上移分组</button>
        <button class="m-r-20" [disabled]="i==data.group.length-1" (click)="movedown(i,data.group)" nz-button
          nzType="primary"><i nz-icon nzType="arrow-down"></i>下移分组</button>
        <button class="m-r-20" [disabled]="data.group.length<=1" (click)="remove(i,data.group)" nz-button
          nzType="danger"><i nz-icon nzType="delete"></i>删除分组</button>
        <button (click)="addRow(list.formControlList,'controlItem')" nz-button nzType="primary"><i nz-icon
            nzType="plus"></i>新增一行</button>
      </div>
    </div>
    <nz-table class="data-table m-b-20" #editRowTable nzBordered [nzData]="list.formControlList"
      [nzPageSize]="list.formControlList.length" [nzSize]="'small'" [nzShowPagination]="false"
      [nzFrontPagination]="false">
      <thead>
        <tr>
          <th>排序</th>
          <th>字段名称</th>
          <th>业务主键</th>
          <th>字段类型</th>
          <th>数据源</th>
          <th>提示信息</th>
          <th>是否必填</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of editRowTable.data;let index=index">
          <td>
            {{index+1}}
          </td>
          <td>
            <input nz-input maxlength="20" placeholder="请输入字段名称" [(ngModel)]="data.controlName" />
          </td>
          <td>
            <input nz-input maxlength="50" placeholder="请输入业务主键" [(ngModel)]="data.controlKey" />
          </td>
          <td>
            <nz-select style="width: 80%; min-width: 100px; margin: auto;" [(ngModel)]="data.type"
              [nzPlaceHolder]="'请选择类型'">
              <nz-option *ngFor='let itemType of type' [nzValue]="itemType.code" [nzLabel]="itemType.name"></nz-option>
            </nz-select>
          </td>
          <td>
            <nz-select style="width: 80%; min-width: 100px; margin: auto;" [nzPlaceHolder]="'请选择数据源'"
              *ngIf='data.type=="select"||data.type=="multipleSelect"' [(ngModel)]="data.dataSource">
              <nz-option *ngFor='let source of dataSource' [nzValue]="source.code" [nzLabel]="source.name"></nz-option>
            </nz-select>
          </td>
          <td>
            <input nz-input placeholder="请输入提示信息" [(ngModel)]="data.placeInfo" />
          </td>
          <td>
            <label nz-checkbox [(ngModel)]="data.require"
              (ngModelChange)="checkchange(data,'require',$event)">是否必填</label>
          </td>
          <td>
            <div class="flex">
              <button class="table-btn" nz-button nzType="'default'" [disabled]="index==0"
                (click)="moveup(index,list.formControlList)">
                <i nz-icon nzType="arrow-up"></i>上移
              </button>
              <button class="table-btn" nz-button nzType="'default'" [disabled]="index==list.formControlList.length-1"
                (click)="movedown(index,list.formControlList)">
                <i nz-icon nzType="arrow-down"></i>下移
              </button>
              <button class="table-btn" nz-button nzType="'default'" [disabled]="list.formControlList.length<=1"
                (click)="remove(index,list.formControlList)">
                <i nz-icon nzType="delete"></i>删除
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>
  <div nz-row nzType="flex" nzJustify="center">
    <button class="m-r-20" nz-button nzType="default" (click)="back()">返回列表</button>
    <button class="m-r-20" *ngIf="data.type=='new'" nz-button nzType="primary" (click)="submitnew()">提交审核</button>
    <button *ngIf="data.type=='edit'" nz-button nzType="primary" (click)="submitid()">提交审核</button>
  </div>
</nz-card>