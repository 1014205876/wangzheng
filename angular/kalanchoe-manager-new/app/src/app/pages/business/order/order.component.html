<div class="container">
    <app-crumb [url]="['客户与订单','订单管理']"></app-crumb>
    <nz-card class="shadow">
        <div class="gutter-example">
            <div nz-row nzGutter="16">
                <div nz-col class="gutter-row" nzSpan="6">
                    <span>订单号：</span>
                    <div class="gutter-box">
                        <input nz-input placeholder="请输入订单号" [(ngModel)]="no">
                    </div>
                </div>
                <div nz-col class="gutter-row" nzSpan="6">
                    <span>企业名称：</span>
                    <div class="gutter-box">
                        <input nz-input placeholder="请输入企业名称" [(ngModel)]="etpName">
                    </div>
                </div>
                <div nz-col class="gutter-row" nzSpan="6">
                    <span>客户账号：</span>
                    <div class="gutter-box">
                        <input nz-input placeholder="请输入客户账号" [(ngModel)]="regMobile">
                    </div>
                </div>
                <div nz-col class="gutter-row" nzSpan="6">
                    <span>客户拓展人：</span>
                    <div class="gutter-box">
                        <input nz-input placeholder="请输入客户拓展人账号" [(ngModel)]="insStaffName">
                    </div>
                </div>
                <div nz-col class="gutter-row" nzSpan="6">
                    <span>申请产品：</span>
                    <div class="gutter-box">
                        <nz-select style="width:100%" [(ngModel)]="productId" nzAllowClear nzPlaceHolder="请选择申请产品">
                            <nz-option *ngFor="let list of productArr" [nzValue]="list.id" [nzLabel]="list.name">
                            </nz-option>
                        </nz-select>
                    </div>
                </div>
                <div nz-col class="gutter-row" nzSpan="12">
                    <span>放款日期范围</span>
                    <div class="gutter-box">
                        <nz-date-picker [nzStyle]="{width:'100%'}" [nzDisabledDate]="disabledStartDate"
                            [nzShowTime]="false" nzFormat="yyyy-MM-dd" [(ngModel)]="startValue"
                            nzPlaceHolder="请输入放款日期开始时间" [nzOpen]="startOpen" (ngModelChange)="onStartChange($event)"
                            (nzOnOpenChange)="handleStartOpenChange($event)">
                        </nz-date-picker>
                        <span style="width:16px;text-align:center">~~</span>
                        <nz-date-picker [nzStyle]="{width:'100%'}" [nzDisabledDate]="disabledEndDate"
                            [nzShowTime]="false" nzFormat="yyyy-MM-dd" [(ngModel)]="endValue"
                            nzPlaceHolder="请输入放款日期结束时间" [nzOpen]="endOpen" (ngModelChange)="onEndChange($event)"
                            (nzOnOpenChange)="handleEndOpenChange($event)">
                        </nz-date-picker>
                    </div>
                </div>
                <div nz-col class="gutter-row" nzSpan="6">
                    <span>&nbsp;</span>
                    <div class="gutter-box">
                        <button nz-button nzType="primary" (click)="getData()">查询</button>
                        <button nz-button nzType="default" style="margin-left:8px;" (click)="reset()">重置</button>
                    </div>
                </div>
            </div>
        </div>
    </nz-card>

    <nz-card class="shadow mt20" [nzTitle]="cardTitle" [nzExtra]="cardExtra">
        <nz-table #rowSelectionTable [nzData]="data" nzShowPagination=false>
            <thead>
                <tr>
                    <th nzShowCheckbox [(nzChecked)]="allChecked" [nzIndeterminate]="indeterminate"
                        (nzCheckedChange)="checkAll($event)"></th>
                    <th>订单号</th>
                    <th>外部项目编号</th>
                    <th>企业名称</th>
                    <th>客户账号</th>
                    <th>客户拓展人</th>
                    <th>申请产品</th>
                    <th>放款金额（万元）</th>
                    <th>贷款期限（月）</th>
                    <th>放款日期</th>
                    <th>数据更新日期</th>
                    <th>分润执行状态</th>
                    <th>分润执行时间</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let data of rowSelectionTable.data">
                    <td nzShowCheckbox [nzDisabled]="data.shareStatus=='1'" [(nzChecked)]="data.check"
                        (nzCheckedChange)="checkOne($event,data)"></td>
                    <td>{{data.no}}</td>
                    <td>{{data.outNo}}</td>
                    <td>{{data.etpName}}</td>
                    <td>{{data.regMobile}}</td>
                    <td>{{data.insStaffName}}</td>
                    <td>{{data.productName}}</td>
                    <td>{{data.amount}}</td>
                    <td>{{data.term}}</td>
                    <td>{{data.loanDate}}</td>
                    <td>{{data.createDate}}</td>
                    <td>
                        <span *ngIf="data.shareStatus=='0'">未执行</span>
                        <span *ngIf="data.shareStatus=='1'">已执行</span>
                        <span *ngIf="data.shareStatus=='2'">处理完成</span>
                    </td>
                    <td>{{data.shareDate}}</td>
                </tr>
            </tbody>
        </nz-table>
        <div class="pagination" *ngIf="total!=0">
            <nz-pagination [nzPageIndex]="pageNum" [nzTotal]="total" (nzPageIndexChange)="pageSearch($event)"
                nzShowQuickJumper></nz-pagination>
        </div>
    </nz-card>
    <ng-template #cardTitle>
        <div class="cardTitle">订单列表</div>
    </ng-template>
    <ng-template #cardExtra>
        <div class="cardExtra">
            <button nz-button nzType="primary" (click)="profitModelShow()">为选中订单执行分润</button>
            <nz-upload nzAccept=".xls,.xlsx" [nzAction]="'/upload'" (nzChange)="change($event)"
                [nzShowUploadList]="false">
                <button nz-button nzType="primary">导入订单信息</button>
            </nz-upload>
        </div>
    </ng-template>

    <nz-modal [(nzVisible)]="profitModel.modalShow" [nzTitle]="profitModelTitle" [nzContent]='profitModelContent'
        [nzFooter]='profitModelFooter' (nzOnCancel)='profitModelCancel()'>
    </nz-modal>
    <!-- 弹窗标题 -->
    <ng-template #profitModelTitle>
        执行分润
    </ng-template>
    <!-- 弹窗内容 -->
    <ng-template #profitModelContent>
        您确定要为选中订单执行分润吗？
    </ng-template>
    <!-- 弹窗底部 -->
    <ng-template #profitModelFooter>
        <nz-form-control style='text-align: right'>
            <button nz-button nzType="default" (click)="profitModelCancel()">取消</button>
            <button nz-button nzType="primary" (click)='shareProfit()'
                [nzLoading]='profitModel.modalLoading'>确定执行</button>
        </nz-form-control>
    </ng-template>
</div>