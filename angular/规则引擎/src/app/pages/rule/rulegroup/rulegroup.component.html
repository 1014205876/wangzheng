<app-menu [menu]="['规则模型','规则分组']"></app-menu>
<nz-card class="shadow" [nzTitle]="cardTitle" [nzExtra]="cardExtra">
    <nz-table #nzTable [nzData]="data" [nzLoading]="loading" [nzShowPagination]="false">
        <thead>
            <tr>
                <th nzWidth='40%'>产品名称</th>
                <th nzWidth='30%'>更新日期</th>
                <th nzWidth='30%'>操作</th>
            </tr>
        </thead>
        <tbody>
            <ng-template ngFor let-data [ngForOf]="nzTable.data">
                <ng-template ngFor let-item [ngForOf]="expandDataCache[data.id]">
                    <tr *ngIf="(item.parent&&item.parent.expand)||!(item.parent)">
                        <td [nzIndentSize]="item.level*20" [nzShowExpand]="!!item.item.children" [(nzExpand)]="item.expand"
                            (nzExpandChange)="collapse(expandDataCache[data.id],item,$event)" style='text-align:left'>
                            {{item.item.name}}
                        </td>
                        <td>{{item.item.updateTime}}</td>
                        <td>
                            <span style='cursor:pointer;padding:5px' (click)="groupModalShow(item.item.id,item.item.title,'','add')">
                                <i class="anticon anticon-folder-add"></i>
                                添加下级
                            </span>
                            <span style='cursor:pointer;padding:5px' (click)="groupModalShow(item.item.parentId,item.item.title,item.item,'edit')">
                                <i class="anticon anticon-edit"></i>
                                编辑
                            </span>
                            <span style='cursor:pointer;padding:5px' (click)='removeModalShow(item.item.id)'>
                                <i class="anticon anticon-delete"></i>
                                删除
                            </span>
                        </td>
                    </tr>
                </ng-template>
            </ng-template>
        </tbody>
    </nz-table>
</nz-card>
<ng-template #cardTitle>
    <span>分组列表</span>
</ng-template>
<ng-template #cardExtra>
    <span>
        <button nz-button nzType="primary" (click)='openall()'>展开全部</button>
        <button nz-button nzType="primary" (click)='closeall()'>收起全部</button>
        <button nz-button nzType="primary" (click)="groupModalShow(null,'','','new')">创建分组</button>
    </span>
</ng-template>
<!-- 创建分组弹窗 -->
<nz-modal [(nzVisible)]="group.modalShow" [nzTitle]="groupModelTitle" [nzContent]='groupModelContent' [nzFooter]='groupModelFooter'
    (nzOnCancel)='groupModelCancel()'>
</nz-modal>
<!-- 弹窗标题 -->
<ng-template #groupModelTitle>
    {{group.title}}
</ng-template>
<!-- 弹窗内容 -->
<ng-template #groupModelContent>
    <div style='position:relative'>
        <form nz-form [formGroup]="groupForm">
            <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="name" nzRequired>分组名称</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <input nz-input type="text" id="name" formControlName="name" placeholder="请输入分组名称" maxlength="50">
                    <nz-form-explain *ngIf="groupForm.get('name').dirty && groupForm.get('name').errors">请输入分组名称!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="fatherGroup">上级分组</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24" (click)='choiceFatherGroup(group.fatherGroup)'>
                    <input nz-input type="text" id="fatherGroup" formControlName="fatherGroup" placeholder="请选择上级分组"
                        maxlength="50" disabled [ngClass]="{'disabled':!group.fatherGroup}">
                    <nz-form-explain *ngIf="groupForm.get('fatherGroup').dirty && groupForm.get('fatherGroup').errors">请选择上级分组!</nz-form-explain>
                </nz-form-control>
            </nz-form-item>
            <nz-form-item>
                <nz-form-label [nzSm]="6" [nzXs]="24" nzFor="remark">备注信息</nz-form-label>
                <nz-form-control [nzSm]="14" [nzXs]="24">
                    <textarea nz-input formControlName="remark" rows="3" placeholder="备注信息"></textarea>
                </nz-form-control>
            </nz-form-item>
        </form>
        <div class='selectTree' *ngIf='group.selectTreeShow'>
            <nz-tree [(ngModel)]="nodes" [nzShowLine]="false" [nzDraggable]="true" (nzClick)="mouseAction($event)">
            </nz-tree>
            <!-- <nz-table #nzTable [nzData]="data" [nzLoading]="loading">
                <tbody>
                    <tr>
                        <td [nzIndentSize]="20" style='text-align:left'>
                            <span style="cursor: pointer" (click)="consol([''])">
                                ---
                            </span>
                        </td>
                    </tr>
                    <ng-template ngFor let-data [ngForOf]="nzTable.data">
                        <ng-template ngFor let-item [ngForOf]="nodes[data.id]">
                            <tr *ngIf="(item.parent&&item.parent.expand)||!(item.parent)">
                                <td [nzIndentSize]="item.level*20" [nzShowExpand]="!!item.item.children" [(nzExpand)]="item.expand"
                                    (nzExpandChange)="collapse(nodes[data.id],item,$event)" style='text-align:left'>
                                    <span style='cursor: pointer' (click)='consol([item.item])'>
                                        {{item.item.name}}
                                    </span>
                                </td>
                            </tr>
                        </ng-template>
                    </ng-template>
                </tbody>
            </nz-table> -->
        </div>
    </div>
</ng-template>
<!-- 弹窗底部 -->
<ng-template #groupModelFooter>
    <nz-form-control style='text-align: right'>
        <button nz-button nzType="default" (click)="groupModelCancel()">取消</button>
        <button nz-button nzType="primary" [disabled]="!groupForm.valid" (click)='groupModelOk()' [nzLoading]='group.modalLoading'>提交</button>
    </nz-form-control>
</ng-template>
<!-- 删除分组弹窗 -->
<nz-modal [(nzVisible)]="remove.modalShow" [nzTitle]="removeModelTitle" [nzContent]='removeModelContent' [nzFooter]='removeModelFooter'
    (nzOnCancel)='removeModelCancel()'>
</nz-modal>
<!-- 弹窗标题 -->
<ng-template #removeModelTitle>
    {{remove.title}}
</ng-template>
<!-- 弹窗内容 -->
<ng-template #removeModelContent>
    您确定要删除分组吗?删除后下级分组也将同时被删除。
</ng-template>
<!-- 弹窗底部 -->
<ng-template #removeModelFooter>
    <nz-form-control style='text-align: right'>
        <button nz-button nzType="default" (click)="removeModelCancel()">取消</button>
        <button nz-button nzType="primary" (click)='removeModelOk()' [nzLoading]='remove.modalLoading'>确定删除</button>
    </nz-form-control>
</ng-template>