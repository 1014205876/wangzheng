<!-- <nz-spin nzTip="加载中..."  [nzSpinning]="spinning" > -->
<app-breadcrumbs [breadcrumbs]="['组织架构','员工管理']"></app-breadcrumbs>
<nz-card class="card search-card" [appResource]="{authName:'get/users/grid'}">
  <div nz-row>
    <div class="gutter-box" nz-col nzSpan="6">
      <nz-form-item>
        <nz-form-label>员工账号</nz-form-label>
        <nz-form-control>
          <input nz-input maxlength="20" placeholder="请输入员工账号" [(ngModel)]="searchItems.account">
        </nz-form-control>
      </nz-form-item>
    </div>
    <div class="gutter-box" nz-col nzSpan="6">
      <nz-form-item>
        <nz-form-label>员工姓名</nz-form-label>
        <nz-form-control>
          <input nz-input maxlength="50" placeholder="请输入员工姓名" [(ngModel)]="searchItems.name">
        </nz-form-control>
      </nz-form-item>
    </div>
    <div class="gutter-box" nz-col nzSpan="6">
      <nz-form-item>
        <nz-form-label>手机号码</nz-form-label>
        <nz-form-control>
          <input nz-input maxlength="20" placeholder="请输入手机号码" [(ngModel)]="searchItems.mobile">
        </nz-form-control>
      </nz-form-item>
    </div>
    <div class="gutter-box" nz-col nzSpan="6">
      <nz-form-item>
        <nz-form-label>状态</nz-form-label>
        <nz-form-control>
          <nz-select class="search-select" [(ngModel)]="searchItems.status" nzAllowClear nzPlaceHolder="请选择状态">
            <nz-option nzValue="" nzLabel="所有状态"></nz-option>
            <nz-option nzValue="0" nzLabel="禁用"></nz-option>
            <nz-option nzValue="1" nzLabel="启用"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>
    <div class="gutter-box" nz-col nzSpan="6">
      <nz-form-item>
        <nz-form-label>所在部门</nz-form-label>
        <nz-form-control>
          <nz-select class="search-select" [(ngModel)]="searchItems.status" nzAllowClear nzPlaceHolder="请选择所在部门">
            <nz-option [nzCustomContent]="true" nzValue="" nzLabel="----">----</nz-option>
            <nz-option [nzCustomContent]="true" nzValue="{{item.id}}" nzLabel="{{item.fullName}}"
              *ngFor="let item of department">
              <i [ngStyle]="{'padding-left': item.level>1? (item.level-1)*15+'px': 0+'px'}">&nbsp;</i>
              <img src="../../../../assets/images/icon/department.png" style="height: 14px;" />
              {{item.fullName}}
            </nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>
    <div class="gutter-box" nz-col nzSpan="6">
      <nz-form-item>
        <nz-form-label>&nbsp;</nz-form-label>
        <nz-form-control>
          <button nz-button nzType="primary" (click)="search(1)"><i class="anticon anticon-search"></i>查询</button>
          <button nz-button nzType="default" (click)="reset()"><i nz-icon nzType="close" nzTheme="outline"></i>重置</button>
        </nz-form-control>
      </nz-form-item>
    </div>
  </div>
</nz-card>
<nz-card class="card" [nzTitle]="'员工列表'" [nzExtra]="extraTemplate">
  <nz-table #basicTable class="data-table" [nzData]="rows" [nzLoading]="spinning" [nzSize]="'small'"
    [nzShowPagination]="false" [nzBordered]="true" [nzLoadingDelay]="loadingDelay">
    <thead>
      <tr>
        <th>员工账号</th>
        <th>员工姓名</th>
        <th>手机号码</th>
        <th>部门</th>
        <th>职级</th>
        <th>更新时间</th>
        <th [appResource]="{authName:'patch/user/status'}">状态</th>
        <th [nzLeft]>操作</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of basicTable.data">
        <td>{{data.account}}</td>
        <td>{{data.name}}</td>
        <td>{{data.mobile}}</td>
        <td>{{data.departmentName}}</td>
        <td>{{data.occupationClass}}</td>
        <td class="td-center">{{data.updateDate}}</td>
        <td class="td-center" [appResource]="{authName:'patch/user/status'}">
          <nz-switch [ngModel]="data.status==1" (ngModelChange)="switchange(data)"></nz-switch>
        </td>
        <td class="td-center">
          <button [appResource]="{authName:'post/user/id/role'}" nz-button nzType="default" class="table-btn"
            (click)="role(data);modalShow('roleAuth','角色指派');createCheckboxModal(modalTplTitle,modalCheckboxContent,modalTplFooter);"><i
              nz-icon nzType="edit" nzTheme="outline"></i>角色指派</button>
          <button [appResource]="{authName:'get/user/id'}" nz-button nzType="default" class="table-btn"
            (click)="getUserInfo(data.id);modalShow('readInfo','查看详情');createCheckboxModal(modalTplTitle,modalTpl,modalTplFootSure);"><i
              nz-icon nzType="edit" nzTheme="outline"></i>查看</button>
          <button [appResource]="{authName:'put/user/id'}" nz-button nzType="default" class="table-btn"
            [routerLink]="['employee-modify']" [queryParams]="{id: data.id}"><i
              nz-icon nzType="edit" nzTheme="outline"></i>编辑</button>
          <button [appResource]="{authName:'post/user/id/area'}" nz-button nzType="default" class="table-btn"
            (click)="modalShow('dataAuth','数据权限指派');getArea(data);createCheckboxModal(modalTplTitle,modalTreeContent,modalTplFooter);"><i
              nz-icon nzType="edit" nzTheme="outline"></i>数据权限指派</button>
          <button [appResource]="{authName:'patch/user/resetpass'}" nz-button nzType="default" class="table-btn"
            (click)="resetPass(data)"><i nz-icon nzType="edit" nzTheme="outline"></i>重置密码</button>
          <button [appResource]="{authName:'post/user/id/processData'}" nz-button nzType="default" class="table-btn"
            (click)="getTask(data);modalShow('taskAuth','任务权限指派');createCheckboxModal(modalTplTitle,modalCheckboxContent,modalTplFooter);"><i
              nz-icon nzType="edit" nzTheme="outline"></i>任务权限指派</button>
        </td>
      </tr>
    </tbody>
  </nz-table>
  <app-page-nav [total]="page.total" [totalPage]="page.totalPage" [pageNum]="page.pageNum" [pageSize]="page.pageSize"
    (getCurrentPage)="changePage($event)">
  </app-page-nav>
</nz-card>
<!-- 表格右侧按钮 -->
<ng-template #extraTemplate>
  <button [appResource]="{authName:'post/user'}" nz-button nzType="primary" class="tableBtn"
    [routerLink]="['employee-add']"><i nz-icon nzType="plus" nzTheme="outline"></i>添加员工</button>
</ng-template>
<!-- 弹窗头部 -->
<ng-template #modalTplTitle>
  <span>{{modalTitle}}</span>
</ng-template>
<!-- 弹窗底部按钮 -->
<!-- 取消和确定按钮 -->
<ng-template #modalTplFooter>
  <button nz-button nzType="default" (click)="modalCancel()">取消</button>
  <button nz-button nzType="primary" (click)="modalSure()" [nzLoading]="loading">确定</button>
</ng-template>
<!-- 单个确定按钮 -->
<ng-template #modalTplFootSure>
  <button nz-button nzType="primary" (click)="modalCancel()">确定</button>
</ng-template>
<!-- 多选框 -->
<!-- 角色指派 -->
<!-- 任务权限指派 -->
<ng-template #modalCheckboxContent>
  <div style="overflow: hidden;">
    <div class="row" style="overflow: hidden; width: 110%; height: 300px;">
      <div class="checkbox" style="height: 100%; width: 100%; overflow-y: auto;">
        <div class="checkbox-primary" *ngFor="let item of checkboxData">
          <label nz-checkbox [(ngModel)]="item.disable" [nzDisabled]="item.status==0"
            (ngModelChange)="checkChange(item)">
            <span *ngIf="item.name">{{item.name}}</span>
            <span *ngIf="item.code">{{item.code}}</span>
          </label>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<!-- 树形结构 -->
<!-- 数据权限指派 -->
<ng-template #modalTreeContent>
  <div >
    <div class="row" style="height: 580px;">
      <div class="sub-title">区域权限</div>
        <div class="tree-box">
          <nz-spin [nzSpinning]="treeLoading" nzTip="加载中..." [nzDelay]="500">
            <div class="nz-tree">
              <nz-tree nzCheckable nzAsyncData (nzExpandChange)="asyncLoadingTree($event)"  [(nzData)]="treeData" [nzCheckedKeys]="treeCheckedKeys"
                [nzExpandedIcon]="expandedIconTpl" (nzCheckBoxChange)="checkboxChange($event)" >

                <ng-template #expandedIconTpl let-node>
                  <i *ngIf="!node.origin.isLeaf" nz-icon [type]="node.isExpanded ? 'minus-square' : 'plus-square'"></i>
                </ng-template>
              </nz-tree>
            </div>
          </nz-spin>
        </div>
    </div>
  </div>
</ng-template>
<!-- 查看详情 -->
<ng-template #modalTpl>
  <div nz-row>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">员工账号</nz-form-label>
      <nz-form-control [nzSpan]="16">{{userInfo.account}}</nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">员工姓名</nz-form-label>
      <nz-form-control [nzSpan]="16">{{userInfo.name}}</nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">手机号码</nz-form-label>
      <nz-form-control [nzSpan]="16">{{userInfo.mobile}}</nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">所属部门</nz-form-label>
      <nz-form-control [nzSpan]="16">{{userInfo.departmentName}}</nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">岗位名称</nz-form-label>
      <nz-form-control [nzSpan]="16">{{userInfo.jobName}}</nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">职位级别</nz-form-label>
      <nz-form-control [nzSpan]="16">{{userInfo.occupationClass}}</nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">角色</nz-form-label>
      <nz-form-control [nzSpan]="16"><span *ngFor="let item of userInfo.roleNames">{{item}}&nbsp;&nbsp;</span>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">状态</nz-form-label>
      <nz-form-control [nzSpan]="16">
        <span *ngIf="userInfo.status==0">禁用</span>
        <span *ngIf="userInfo.status==1">启用</span>
      </nz-form-control>
    </nz-form-item>
    <nz-form-item style="margin-bottom: 0;">
      <nz-form-label [nzSpan]="6">更新时间</nz-form-label>
      <nz-form-control [nzSpan]="16">{{userInfo.updateDate}}</nz-form-control>
    </nz-form-item>
  </div>
</ng-template>