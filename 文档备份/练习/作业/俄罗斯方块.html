<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			* { margin: 0; padding: 0; }
			#box{ position: relative; width: 600px; height: 500px; margin: 0 auto; border: 2px #999 solid; overflow: hidden; }
			#wrap { position: absolute; bottom: 0; width: 600px; }
			.row { position: absolute; overflow: hidden; }
			.row div { float: left; width: 20px; height: 20px; border:1px #000 solid; box-sizing: border-box; background: #ccc; }
			#fraction{ position: absolute; top: 5px; width: 100%; text-align: center; font-size: 50px; color: #333; }
		</style>
	</head>
	<body>
		<p id="fraction">0</p>
		<div id="box">
			<div id="wrap"></div>
		</div>
		
		<script>
			var wrap=document.getElementById('wrap');
			var fraction=document.getElementById("fraction"); //计分器
			var rowNum = 20;   //代表每一行里的小方块的个数
			var pieceWidth=20;   //每一个小方块的宽度
			var thetime=500;
			var thebottom=0;
			var timer=null;
			var lock=false;
			
			
			
			
			
			
			
			
			
			createRow();
			function createRow()
			{
				var row=document.createElement('div');
				row.className='row';
				row.style.bottom=thebottom+'px';
				row.direction=true;
				row.style.width=rowNum*pieceWidth+'px';
				
				
				
				wrap.appendChild(row);
				
				
				for(i=0;i<rowNum;i++)
				{
					var piece=document.createElement('div');
					row.appendChild(piece);
				}
				moveRow(row);
				return row;
			}
			
			
			
			function moveRow(row)
			{
				var rowStart=row.offsetLeft;
				var maxWidth=wrap.clientWidth-row.offsetWidth;
				
				row.timer=setInterval(function()
				{
					if(row.direction)
					{
						rowStart+=20;
						if(rowStart>=maxWidth)
						{
							rowStart=maxWidth;
							row.direction=false;
						}
					}
					else
					{
						rowStart-=20;
						if(rowStart<=0)
						{
							rowStart=0;
							row.direction=true;
						}
					}
					row.style.left=rowStart+'px';
				},thetime)
			}
			
			
			box.onclick=function()
			{
				if(lock)
				{
					return;
				}
				lock=true;
				
				setTimeout(function()
				{
					lock=false;
				},10)
				
				fraction.innerHTML++;
				thetime-=50;
				if(thetime<=100)
				{
					thetime=100;
				}
				
				thebottom+=20;
				if(thebottom>=200)
				{
					wrap.style.bottom=-(thebottom-200)+'px';
				}
				removeTd();
				var row=createRow();
				var preRow=row.previousElementSibling;
				clearInterval(preRow.timer);
				
			}
			
			function removeTd()
			{
				var nowRow=wrap.lastElementChild;
				var nowPreRow=nowRow.previousElementSibling;
				
				if(nowPreRow)
				{
					var difference=nowRow.offsetLeft-nowPreRow.offsetLeft;
				}
				else{
					var difference=0;
				}
				
				var removeNum=difference/pieceWidth;
				
				rowNum-=Math.abs(removeNum);
				if(rowNum<=0)
				{
					alert('游戏结束');
					clearInterval(nowRow.timer)
					box.onclick=function()
					{
						alert('游戏结束');
					}
				}
				
				if(removeNum>0)
				{
					for(var i=0;i<removeNum;i++)
					{
						nowRow.removeChild(nowRow.lastElementChild);
					}
				}
				else
				{
					removeNum=-removeNum;
					for(var i=0;i<removeNum;i++)
					{
						nowRow.removeChild(nowRow.firstElementChild);
					}
					nowRow.style.left=nowRow.offsetLeft+removeNum*20+'px';
				}
			}
			

			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
//				var start=0;
//				time1=setInterval(function()
//				{
//					if(start<0||start>180)
//					{
//						j=-j;
//					}
//					start+=j;
//					row.style.marginLeft=start+'px';
//				},100)
				
				
				
				
				
				
				
			
			
		</script>
		
	</body>
</html>